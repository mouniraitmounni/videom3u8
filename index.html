<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل بث مباشر m3u8</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            position: relative;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>

    <video id="video" controls></video>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        // إعداد Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // تهيئة تطبيق Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // الدالة لجلب رابط البث من Firebase
        function getStreamUrl() {
            return database.ref('/matches/match1/stream_url').once('value').then((snapshot) => {
                return snapshot.val();  // إرجاع رابط البث المباشر من Firebase
            });
        }

        // تحميل الفيديو بعد جلب رابط البث من Firebase
        getStreamUrl().then((streamUrl) => {
            if (streamUrl) {
                var proxyUrl = "https://cors-anywhere.herokuapp.com/";  // خادم البروكسي الذي يدعم HTTPS
                var videoSrc = proxyUrl + streamUrl;

                var video = document.getElementById('video');

                if (Hls.isSupported()) {
                    var hls = new Hls();
                    hls.loadSource(videoSrc);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });
                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error("خطأ في تشغيل البث المباشر:", data);
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = videoSrc;
                    video.addEventListener('loadedmetadata', function() {
                        video.play();
                    });
                }
            } else {
                console.error("لم يتم العثور على رابط البث في قاعدة البيانات");
            }
        }).catch((error) => {
            console.error("خطأ في جلب البيانات من Firebase:", error);
        });

    </script>

</body>
</html>
